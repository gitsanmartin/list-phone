---
import Layout from "../layouts/Layout.astro";
import { getSession } from "auth-astro/server";

const session = await getSession(Astro.request);
// console.log(session);
---

<Layout title="Welcome to Astro.">
	<main
		class="flex flex-col min-h-screen justify-center items-center text-white"
	>
		<div class="">cosas del index</div>
		{
			session === null ? (
				<>
					<button id="login">Iniciar sesión</button>
					<span>casasas</span>
				</>
			) : (
				<>
					<p>hola {session?.user?.name}</p>
					<p>hola {session?.user?.email}</p>
					<button id="logout">Cerrar sesión</button>
				</>
			)
		}
		<!-- <button class="text-rose-800" id="logout">Cerrar sesión</button>
		<button class="text-rose-800" id="login">Iniciar sesión</button> -->
	</main>
</Layout>

<script>
	const { signIn, signOut } = await import("auth-astro/client");
	const $login = document.querySelector("#login") as HTMLButtonElement | null;
	const $logout = document.querySelector(
		"#logout"
	) as HTMLButtonElement | null;

	if ($login) {
		$login.onclick = () => {
			signIn("google");
			$login.setAttribute("aria-disabled", "true");

			const $span = $login.querySelector("span");
			if ($span) $span.innerText = "Iniciando sesión...";
		};
	}

	if ($logout) {
		$logout.onclick = () => signOut();
	}
	//   document.querySelector("#login").onclick = () => signIn("github");
	//   document.querySelector("#logout").onclick = () => signOut();
</script>
